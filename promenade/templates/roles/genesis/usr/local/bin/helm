#!/usr/bin/env bash

set -e

if [ "x$(pwd)" = "x/" ]; then
    UPDIR=/
    WORKDIR=/up
else
    UPDIR=$(pwd)/..
    WORKDIR=/up/$(basename $(pwd))
fi

exec docker run --rm \
    --net host \
    -v $UPDIR:/up \
    -v /etc/kubernetes/admin:/etc/kubernetes/admin \
    -w $WORKDIR \
    -e KUBECONFIG=/etc/kubernetes/admin/kubeconfig.yaml \
    -e HTTP_PROXY=http://one.proxy.att.com:8888 \
    -e HTTPS_PROXY=http://one.proxy.att.com:8888 \
    -e NO_PROXY=127.0.0.1,localhost,.cluster.local,10.96.0.0/16,10.97.0.0/16 \
    {{ config['HostSystem:images.helm.helm'] }} \
        $*
